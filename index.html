<!DOCTYPE HTML>
<html>
<head>
<link rel="stylesheet" href="https://cdn.webix.com/edge/webix.css" type="text/css"> 
<script src="https://cdn.webix.com/edge/webix.js" type="text/javascript"></script> 
<style>
.todayCheckbox {
    float: left;
    height: 60px;
    padding-top: 10px;
    width: 40px;
}

.taskName {
    float: left;
    padding-top: 15px;
}

.endDate {
    float: right;
    padding-top: 15px;
}

.detailsButton {
    float: right;
    padding-top: 12px;
}
</style>
</head>
<body>
<script type="text/javascript" charset="utf-8">
webix.protoUI({
    name: "taskList"
}, webix.ui.list, webix.ActiveContent);

webix.ui({
    id:"views",
    cells:[
        {
            id: "listView",
            view: "taskList",
            select: false,
            url: "task-list",
            activeContent: {
                today: {
                    view: "checkbox",
                    width: 30,
                    click: function() {
                        //TODO: send change to server
                    }
                },
                details: {
                    view: "icon",
                    icon: "angle-right",
                    width: 50,
                    click: function(id, e) {
                        var item_id = $$("listView").locate(e);
                        $$("listView").select(item_id);
                        $$('formView').show();
                    }
                }
            },
            template: "<div class='todayCheckbox'>{common.today()}</div><div class='taskName'>#name#</div><div class='detailsButton'>{common.details()}</div><div class='endDate'>#end#</div>",
            type: {
                height: 65
            }
        },
        {
            id: "formView",
            view: "form",
            scroll: false,
            elements: [ 
                { 
                    view: "text", 
                    label: "Название", 
                    labelWidth: 120,
                    labelAlign: "right",
                    name: "name",
                },
                {
                    view: "counter",
                    label: "Объем работы",
                    labelWidth: 120,
                    labelAlign: "right",
                    name: "size",
                    step: 1,
                    min: 1,
                },
                {
                    view: "counter",
                    label: "План на день",
                    labelWidth: 120,
                    labelAlign: "right",
                    name: "plan",
                    step: 1,
                    min: 1,
                },
                {
                    view: "counter",
                    label: "Готовность",
                    labelWidth: 120,
                    labelAlign: "right",
                    name: "done",
                    step: 1,
                    min: 0,
                },
                {
                    view: "segmented",
                    label: "Режим работы",
                    labelWidth: 120,
                    labelAlign: "right",
                    options: [
                        { id: "workdays", value: "Рабочие" },
                        { id: "holidays", value: "Выходные" },
                        { id: "everyday", value: "Каждый день" },
                    ],
                    name: "mode",
                },
                { 
                    margin: 5, 
                    cols: [
                        { 
                            view: "button", 
                            value: "Отмена",
                            height: 50,
                            click: function() {
                                $$("listView").unselect();
                                $$("views").back();
                            }
                        },
                        { 
                            view: "button", 
                            value: "Сохранить", 
                            type: "form", 
                            height: 50,
                            click: function() {
                                $$("formView").save();
                                $$("listView").unselect();
                                //TODO: reload data
                                $$("views").back();
                            }
                        }
                    ]
                },
                {}
            ]
        },
    ]
});

/*
 binds Form with List:
 - selected item loaded in Form,
 - updating data after form saving
*/
$$('formView').bind($$('listView'));
webix.history.track("views", "listView");

</script>
</body>
</html>
